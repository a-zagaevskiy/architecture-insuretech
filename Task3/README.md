# Анализ архитектуры As-Is

* REST API сервиса ins-product-aggregator

API синхронное, и в рамках него осуществляются запросы данных из нескольких внешних систем (API страховых компаний). Время выполнения такого запроса будет складываться из задержек работы API внешних систем (в зависимости от степени распараллеливании запросов, в лучшем случае будет равняться максимальной задержке самого медленного запроса). Сложно обрабатывать сбои (частично успешный запрос или ошибка выполнения всего агрегирующего запроса), усложняется и логика обработки таких ошибок в core-app и ins-comp-settlement. В планах бизнеса увеличить число внешних систем в 2 раза, что сильнее повлияет на RPS данного API и увеличит вероятность его сбоев.

* Данные для сервиса ins-comp-settlement

Сервис ins-comp-settlement при формировании реестра оформленных страховок один раз в сутки (ночью) пытается получить данные внешних систем (через RESP API ins-product-aggregator). Однако, сбои в работе API страховых компании в ночное время может приводить к невозможности сформировать реестр. Но тут не принимается во внимание тот факт, что этим же RESP API пользуется сервис core-app намного чаще (раз в 15 мин). Вполне разумным было бы разрешить использовать последние, самые актуальные данные, полученные сервисом ins-comp-settlement.

Информацию по последним условиям можно было бы хранить в БД сервиса ins-product-aggregator и предоставлять по тому же REST API, который бы вместо реального опроса отдавал бы данные из базы.

* Нагрузка сервиса core-app

Увеличение нагрузки на сервис core-app (например, от наплыва клиентов на сайт компании или всплеска активности партнеров, оформляющих страховки) может также влиять на возможности сервиса ins-comp-settlement сформировать реестр оформленных страховок. Объем данных core-app (оформленные за день страховки) тоже может быть немаленьким, что скажется на успешности выполнения данной функции сервисом ins-comp-settlement, а значит и на задачу бизнеса произвести взаиморасчеты со страховыми компаниями по прошествии дня.